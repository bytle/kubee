

[//]: # (README.md generated by gotmpl. DO NOT EDIT.)

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![Version: 0.0.1](https://img.shields.io/badge/Version-0.0.1-informational?style=flat-square) ![AppVersion: 34.4.1](https://img.shields.io/badge/AppVersion-34.4.1-informational?style=flat-square)

# Kubee Traefik Chart

This [Kubee App Chart](https://github.com/EraldyHq/kubee/blob/main/docs/site/app-chart.md) installs the [traefik proxy](https://traefik.io)

<img src="contrib/traefik-entrypoints-illustration.jpg" alt="Alt text" width="1000">

## Features

### Traefik Dashboard

If a `hostname` is given, the [traefik dashboard](https://doc.traefik.io/traefik/operations/dashboard/) is configured
with authentication (See `auth.middleware_name`)

### Monitoring 

The [Traefik Mixin](https://monitoring.mixins.dev/traefik/) is installed (Grafana and Scrape)

### Automatic CRDS
The [traefik-crds chart](../traefik-crds/README.md) is installed automatically if not found.

### Kubee Charts Features

  These [kubee charts](https://github.com/EraldyHq/kubee/blob/main/docs/site/kubee-helmet-chart.md) add their features when `enabled`.

* [cert-manager](https://github.com/EraldyHq/kubee/blob/main/charts/cert-manager/README.md) adds [server certificates](https://cert-manager.io/docs/usage/certificate/) to the servers
* [grafana](https://github.com/EraldyHq/kubee/blob/main/charts/grafana/README.md) creates [dashboards](https://grafana.com/grafana/dashboards/)
* [oauth2-proxy](https://github.com/EraldyHq/kubee/blob/main/charts/oauth2-proxy/README.md)
* [prometheus](https://github.com/EraldyHq/kubee/blob/main/charts/prometheus/README.md) creates [metrics scraping jobs](https://prometheus.io/docs/concepts/jobs_instances/) and [alert rules](https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/)

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| auth.middleware_name | string | `"basic-auth"` | The authentication middleware This middleware is applied on internal web app (such as Traefik Dashboard, Prometheus, Alert Manager, ...) The app or api endpoints are still available from an internal container The supported middleware name are basic-auth and forward-auth Before changing to forward-auth, you should test it with the whoami chart |
| auth.private_networks | list | `[]` | The Private Network ranges used for Ingress Ip restrictions (Traefik IpAllowList) Example for a home ip: 143.176.206.80/32 |
| enabled | bool | `false` | Boolean to indicate that this chart is or will be installed in the cluster |
| hostname | string | `""` | The public Traefik dashboard hostname example: hostname: 'traefik-haship.nip.io' |
| middlewares.basic_auth.users | object | `{}` | List of extra users alongside the admin user |
| namespace | string | `"kube-system"` | The installation namespace. The kube-system namespace tells kubernetes that this app has a higher priority |
| traefik | object | | [the Optional Traefik Chart values](https://github.com/traefik/traefik-helm-chart/blob/v34.4.1/traefik/values.yaml) |

## Install

```bash
kubee --cluster cluster-name helmet play traefik
```

## FAQ
### Where do I set the trusted Proxy?

If you put your Cluster being a proxy such as Cloudflare.
You need to set the trusted cidrs in the `ports.websecure.forwardedHeaders.trustedIPs`

```yaml
# Kubee Helm
traefik:
  # Traefik Helm
  traefik:
    ports:
      websecure:
        forwardedHeaders:
          trustedIPs: ['173.245.48.0/20','103.21.244.0/22','103.22.200.0/22']
```

It enables the forwarding of X-Headers
[Doc](https://doc.traefik.io/traefik/v2.3/routing/entrypoints/#forwarded-headers)

### Where can I set the Values of the Traefik Helm Chart?

This chart is an Umbrella Chart based on the [Traefik Chart](https://github.com/traefik/traefik-helm-chart):
* [Markdown](https://github.com/traefik/traefik-helm-chart/blob/master/traefik/VALUES.md)

You can set this extra values under the `traefik/traefk` node of you cluster values file.
```yaml
# Kubee Traefik Helm
traefik:
  # Traefik Helm
  traefik:
    ports:
      websecure:
        forwardedHeaders:
          trustedIPs: ['173.245.48.0/20','103.21.244.0/22','103.22.200.0/22']
```

### How can I contribute (Dev)

The dev documentation is available [here](contrib/contrib.md)